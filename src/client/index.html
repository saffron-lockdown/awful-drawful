<html>
  <head>
    <title>Drawful clone</title>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.2.0/fabric.min.js"
      integrity="sha512-Pdu3zoEng2TLwwjnDne3O7zaeWZfEJHU5B63T+zLtME/wg1zfeSH/1wrtOzOC37u2Y1Ki8pTCdKsnbueOlFlMg=="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <label for="name">Name</label>

    <input type="text" id="name" name="name" required size="10" />
    <button type="button" id="submit">submit</button>
    <br />
    <br />
    <div id="name-display"></div>
    <br />
    <div id="prompt-display"></div>

    <div
      class="canvas-container"
      style="width: 500px; height: 500px; position: relative; user-select: none"
    >
      <canvas
        id="c"
        width="500"
        height="500"
        style="
          border: 1px solid rgb(170, 170, 170);
          position: absolute;
          width: 500px;
          height: 500px;
          left: 0px;
          top: 0px;
          touch-action: none;
          user-select: none;
        "
        class="lower-canvas"
      ></canvas>
    </div>
    <button id="serialise">serialise</button>

    <script>
      const socket = new WebSocket('ws://localhost:3000');
      const nameInput = document.querySelector('#name');
      const submitButton = document.querySelector('#submit');
      submitButton.onclick = () => {
        const msg = {
          name: nameInput.value,
        };
        console.log(msg);
        socket.send(JSON.stringify(msg));
      };

      const promptDisplay = document.querySelector('#prompt-display');
      const nameDisplay = document.querySelector('#name-display');

      socket.onmessage = ({ data }) => {
        console.log(data);
        const parsed = JSON.parse(data);
        if (parsed.type === 'NAME') {
          nameDisplay.innerText = 'Hello ' + parsed.payload + '!';
        } else if (parsed.type === 'PROMPT') {
          promptDisplay.innerText = parsed.payload;
        } else {
          console.log('type not recognised', parsed.type);
        }
      };
      var canvas = (this.__canvas = new fabric.Canvas('c', {
        isDrawingMode: true,
      }));
      canvas.freeDrawingBrush.width = 10;
      document.querySelector('#serialise').onclick = () => {
        const out = JSON.stringify(canvas);
        console.log(out);
      };
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Drawful clone</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1.0, user-scalable=0"
    />
    <link href="/main.css" rel="stylesheet" />
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue-icons.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.1/socket.io.js"
      integrity="sha512-AcZyhRP/tbAEsXCCGlziPun5iFvcSUpEz2jKkx0blkYKbxU81F+iq8FURwPn1sYFeksJ+sDDrI5XujsqSobWdQ=="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.2.0/fabric.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.2.4/gsap.min.js"></script>
  </head>
  <body class="h-100 w-100">
    <b-container id="app" class="d-flex flex-column pt-2 pb-2 h-100" v-cloak>
      <template v-if="page === 'set-name'">
        <b-form-group label="Name">
          <b-form-input name="name" v-model="name" @keyup.enter="setName"></b-form-input>
        </b-form-group>
        <b-button id="set-name-button" key="set-name-button" class="mb-2" @click="setName" variant="primary">
          Set name
        </b-button>
      </template>
      <template id="page-landing" v-if="page === 'landing'">
        <b-button id="name-display" @click="editName = true" variant="light" v-if="page === 'landing'" class="mb-2">
          {{ state.name }} <b-badge>tap to edit</b-badge>
        </b-button>
        <b-form-group label="Game ID">
          <b-form-input
            name="gameId"
            v-bind:value="gameId"
            @input="setGameId"
            @keyup.enter="joinGame"
            maxlength="4"
          ></b-form-input>
        </b-form-group>
        <b-alert id="error-display" show fade v-if="state.errorMessage" variant="danger">
          Error: {{ state.errorMessage }}
        </b-alert>
        <b-button id="join-game-button" class="mb-2" @click="joinGame" variant="success">Join game</b-button>
        <b-button id="create-game-button" class="mb-2" @click="createGame" variant="info">Create game</b-button>
        <b-badge pill variant="light">Built __BUILD_ID__</b-badge>
      </template>
      <template id="page-lobby" v-else-if="page === 'lobby'">
        <div class="d-flex justify-content-end mb-2">
          <b-dropdown right variant="primary" id="game-id-display">
            <template #button-content> Game ID: {{ state.gameId }} </template>
            <b-dropdown-item>
              <b-button id="leave-game-button" key="leave-game-button" @click="leaveGame" variant="outline-danger">
                Leave game
              </b-button>
            </b-dropdown-item>
          </b-dropdown>
        </div>
        <b-alert id="player-list-display" show>
          Players:
          <template v-for="player in state.players">
            <b-badge class="mr-1" :variant="playerVariant(player)">
              {{ player.name }}
              <b-icon-exclamation-triangle-fill
                v-if="playerVariant(player) === 'danger'"
              ></b-icon-exclamation-triangle-fill
            ></b-badge>
          </template>
        </b-alert>
        <b-button id="start-game-button" variant="success" class="mb-2" @click="startGame">Everybody's in!</b-button>
      </template>
      <div id="page-ingame" v-else-if="page === 'ingame'" class="flex-grow-1 d-flex flex-column mb-2">
        <div class="d-flex mb-2">
          <b-progress
            class="flex-grow-1 mr-2"
            height="auto"
            :value="state.timeRemaining"
            :max="state.timerDuration"
            striped
            animated
            variant="primary"
            show-value
          ></b-progress>
          <b-dropdown right variant="light">
            <template #button-content><b-icon-gear-fill></b-icon-gear-fill></template>
            <b-dropdown-item>
              <b-button id="leave-game-button" key="leave-game-button" @click="leaveGame" variant="outline-danger">
                Leave game
              </b-button>
            </b-dropdown-item>
          </b-dropdown>
        </div>
        <b-alert id="display" show>{{ message }}</b-alert>
        <template v-if="!state.isWaiting">
          <template v-if="state.phase === 'DRAW'">
            <drawing id="easel"></drawing>
            <b-button id="post" @click="postDrawing" variant="success">Post</b-button>
          </template>
          <template v-if="state.phase === 'CAPTION'">
            <drawing id="gallery"></drawing>
            <b-form-group label="What is this?">
              <b-form-input v-model="caption" @keyup.enter="postCaption"></b-form-input>
            </b-form-group>
            <b-button id="caption-button" class="mb-2" @click="postCaption" variant="primary">Submit</b-button>
          </template>
          <template v-if="state.phase === 'GUESS'">
            <drawing id="gallery"></drawing>
            <b-card no-body>
              <b-list-group flush>
                <b-list-group-item
                  v-for="caption in state.captions"
                  :key="caption.playerName"
                  button
                  @click="chooseCaption(caption)"
                >
                  {{ caption.text }}
                </b-list-group-item>
              </b-list-group>
            </b-card>
          </template>
        </template>
        <template v-if="state.phase === 'REVEAL'">
          <drawing id="gallery"></drawing>
          <b-list-group flush key="reveal">
            <transition-group name="animated-list" appear>
              <b-list-group-item
                v-for="caption in captions"
                :variant="answerVariant(caption)"
                :key="caption.key"
                class="animated-list-item"
              >
                <span class="mb-1">{{ caption.text }}</span>
                <transition name="bounce" appear>
                  <template v-if="caption.playerName">
                    <b-badge v-if="caption.text !== state.realPrompt" variant="danger">
                      {{ caption.playerName }}'s Lie!
                    </b-badge>
                    <b-badge v-else variant="success"> The Truth! </b-badge>
                  </template>
                </transition>
                <transition-group name="bounce" appear>
                  <b-badge v-for="chooserName in caption.chosenBy" :key="chooserName" variant="primary">
                    {{ chooserName }}
                  </b-badge>
                </transition-group>
              </b-list-group-item>
            </transition-group>
          </b-list-group>
        </template>
        <template v-if="state.phase === 'SCORE'">
          <b-list-group flush key="score">
            <transition-group name="animated-list" appear>
              <b-list-group-item
                v-for="data in animatedScores"
                :key="data.playerName"
                class="d-flex justify-content-between align-items-center animated-list-item"
              >
                <span>{{ data.playerName }}</span>
                <b-badge variant="primary" pill>{{ data.score }}</b-badge>
              </b-list-group-item>
            </transition-group>
          </b-list-group>
        </template>
        <template v-if="state.phase === 'FINALSCORE'">
          <b-alert show variant="success">
            <div class="text-center">
              <h4 class="alert-heading" text-align="center">Congratulations</h4>
              <h1>{{ animatedScores[0].playerName }}!</h1>
            </div>
          </b-alert>
          <h1>Final Scoreboard</h1>
          <template v-for="data in animatedScores">
            <b-list-group-item class="d-flex justify-content-between align-items-center">
              {{ data.playerName }}
              <b-badge variant="primary" pill>{{ data.score }}</b-badge>
            </b-list-group-item>
          </template>
        </template>
      </div>
    </b-container>

    <script src="main.js"></script>
  </body>
</html>
